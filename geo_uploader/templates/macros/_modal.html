<!-- Bootstrap Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmationModalLabel"></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body" id="confirmationModalBody"></div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-info" id="confirm-action-modal-btn"></button>
            </div>
        </div>
    </div>
</div>

<script>
    var confirmationModal;  // Declare a variable to store the modal instance
    var currentFormId;      // Variable to store the form ID that will be submitted
    let showSpinnerFlag; // Global variable to hold the spinner flag
    let spinnerMessage; // Global variable to hold the spinner flag

    function showConfirmationModal(title, message, buttonmsg, formId, showSpinner = false, spinnerText = null) {
        currentFormId = formId;  // Set the form ID that needs to be submitted
        showSpinnerFlag = showSpinner; // Set the spinner flag
        spinnerMessage = spinnerText; // Set the spinner flag

        // Set the modal title and body content
        document.getElementById('confirmationModalLabel').textContent = title;
        document.getElementById('confirmationModalBody').textContent = message;

        // Set the confirm button action and text
        const confirmButton = document.getElementById('confirm-action-modal-btn');
        confirmButton.textContent = buttonmsg;  // Set button text based on action (e.g., "Download" or "Delete")
        confirmButton.onclick = confirmAction;  // Set the click handler for the confirm button

        // Show the modal
        confirmationModal = new bootstrap.Modal(document.getElementById('confirmationModal'), {
            backdrop: 'static',
            keyboard: true,
            // focus: true
        });
        confirmationModal.show();

        // Add event listener for the Enter key
        document.addEventListener('keydown', function handleKeydown(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent form submission if it's inside a form
                confirmAction(); // Call the confirm action
            }
        }, { once: true }); // Use `{ once: true }` to remove the listener after it runs
    }

    function confirmAction() {
        // Close the modal

        confirmationModal.hide();


        // Submit the current form
        document.getElementById(currentFormId).submit();

        if (showSpinnerFlag) {
            showSpinner(spinnerMessage);
        }
    }
</script>
